# Bloc

## Table of contents

- [Introduction](#)
- [Security and Details](#)
  - [Resilience](#)
  - [Encryption](#)
    - [User's key pair](#)
    - [User's password](#)
    - [How file are encrypted ?](#)
  - [Sharing System](#)
    - [Public](#)
    - [Private](#)
- [Roadmap](#)
- [Quickstart](#)
  - [Requirements](#)
  - [You want to contribute to the code ?](#)
  - [You want to deploy bloc in production ?](#)
- [License](#)

## Introduction

Bloc is mainly made for people who need a safe place for their datas, like movements and activists organizing in risk zones (ARZ) or even journalists and whistleblowers needing a safe place to store their documents, proofs, etc.

## Security and Details

### Resilience

Our second security layer is the resiliency of the storage, the goal is that if a government or a company raid the servers where your instance of bloc is hosted, you just need to login with the same username and password on another instance and magic all your files are still here! This will only be archivable using the [Polar network (WIP)](https://codeberg.org/coldwire/polar/src/branch/main/dev/paper.md) and also possible to do using a self-hosted S3 infrastructure but polar is attended to be built over a big network of users and organization so it makes it harder to shutdown.

### Encryption

> The client application is responsible for encryption and the server is responsible for authentication. We use [Liboxyd](https://codeberg.org/coldwire/liboxyd) toolbox made in **WebAssembly** to use encryption functions on web browser

Algorithms used :
  - [ECIES ed25519](https://en.wikipedia.org/wiki/EdDSA)
  - Argon2 ID
  - XChaCha20-Poly1305
  - Blake

#### **User's key pair**

the user's key pair was generated with asymetric **ECIES ed25519** algorithm and is used to decrypt and encrypt files.

She is provided when a user registers on Coldwire authentication service or a specific service. The **ECIES** key pair is always generated by client application.

The private key is stored but encrypted with **ChaCha20-Poly1305** with blake3 hash of the password as the key.

The public key is not encrypted and can be get by anyone, it will be used for files transfer or others future features.

#### **User's password**

the user's password is hashed with **argon2 ID** function and is used to authenticate the user on the application to get a session token.

#### **How file are encrypted ?**

1. A 256bits key is generated
2. The file is encrypted chunk by chunk using **XChaCha20-Poly1305** with the generated key
3. the key is encrypted using user's public key with [ECIES](https://en.wikipedia.org/wiki/Integrated_Encryption_Scheme)
4. The file is uploaded and the encrypted key stored in the metadatas.

### Sharing System

#### Private

A private sharing is the way of sharing files between users of bloc (will work betweens differents instances over polar), this is how it work:

1. Bob click on "sharing to alice"
2. Bob get alice's public key from the API
3. Bob decrypt the key of the file with its private key
4. Bob encrypt the key of the file using alice's public key
5. The file is added to alice's shared files

#### Public

For a public share, the current way is just to share the encryption key in a link, but I'm (monoko) thinking about a way to share without leaking the original key, but seems complicated with decryption on the client side.

## Roadmap

- [x] Bloc API
- [ ] Bloc Frontend
- [x] File Sharing
- [ ] Client Side Encryption
- [ ] Native Client (Rust)
- [ ] WIP Storage Module
- [ ] S3 Storage Module
- [x] File System Storage
- [x] Sqlite Driver
- [x] PostgreSQL Driver
- [ ] Onion/Lokinet Router Module
- [x] Oauth2 Authentication Module
- [x] Local Authentication Module

## Quickstart

### You want to contribute to the code ?

#### Requirements

- Linux host (virtualized or bare metal)
- 500Mo of free memory
- Docker
- Docker Compose
- Git CLI

#### Launch Application

```sh
$ git clone https://codeberg.org/coldwire/bloc.git
$ cd bloc
(bloc) $ sudo systemctl start docker
(bloc) $ sudo docker-compose -f docker-compose-dev.yml up -d --build
```

#### Stop Application

```sh
(bloc) $ sudo docker-compose -f docker-compose-dev.yml down
```

#### Cleanup

```sh
(bloc) $ sudo docker-compose -f docker-compose-dev.yml down
(bloc) $ sudo docker system prune
(bloc) $ sudo docker volume prune
```

### You want to deploy bloc in production ?

#### Config

An exemple config file can be found [here](./exemple.config.toml)

#### Develop

```sh
# In a terminal
cd view && npm i && npm run dev # Ru frontend server

# In a second terminal
DEV_FRONT_URL=http://127.0.0.1:3000/ go run main.go -config config.toml # Run the backend while proxying requests to the frontend so you can dev without rebuilding the frontend everytime :)
```

#### Building

just clone the repo and build with go <1.16

```sh
git clone https://codeberg.org/coldwire/bloc && cd bloc
cd view
npm run build
cd ..
go build main.go
```

then run it
```sh
./main.go
```

## License

MIT License

Copyright (c) 2022 bloc

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
